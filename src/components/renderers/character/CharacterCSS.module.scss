@use "../../../styles/functions" as *;
@use "../../../styles/mixins" as *;

/* Daniele character - PNG sprite based */

.character {
  position: relative;
  inline-size: to-rem(230px);
  block-size: to-rem(
    230px
  ); /* Set explicit height to contain absolutely positioned images */
  transform-origin: bottom center;
}

/* Flip character horizontally when facing left */
.left {
  transform: scaleX(-1);
}

/* Sprite image styling */
.sprite {
  display: block;
  inline-size: 100%;
  block-size: auto;
  background: transparent;
  border: none;
  outline: none;
  user-select: none;
  pointer-events: none;
  transform-origin: bottom center;

  /* Prevent flash by ensuring scale is always applied immediately */
  will-change: transform;

  /* Position both images in the same space, anchored to bottom */
  position: absolute;
  inset-inline: 0;
  inset-block-end: 0;

  /* Default: always scale to 0.65x to prevent flash */
  /* This ensures even if class hasn't updated, the image is scaled */
  transform: scale(0.65);

  @include pixelated;
}

/* Visibility control - used to toggle between static and moving sprites */
.visible {
  opacity: 1;
  visibility: visible;
}

.hidden {
  opacity: 0;
  visibility: hidden;
  /* Keep in DOM but don't render */
  pointer-events: none;
}

/* Static sprite - explicitly scaled down to 0.65x */
.spriteStatic {
  transform: scale(0.65);
}

/* Moving sprite - reset to normal size */
.spriteMoving {
  transform: scale(1);
  filter: brightness(1.3);
}

/* Subtle breathing animation for idle state */
.idle {
  animation: breathe 3s ease-in-out infinite;
}

@keyframes breathe {
  0%,
  100% {
    transform: scaleY(1) scaleX(1);
  }

  50% {
    transform: scaleY(1.01) scaleX(0.995);
  }
}

/* Override breathing for left-facing idle (combine flip with breathe) */
.idle.left {
  animation: breathe-left 3s ease-in-out infinite;
}

@keyframes breathe-left {
  0%,
  100% {
    transform: scaleX(-1) scaleY(1);
  }

  50% {
    transform: scaleX(-0.995) scaleY(1.01);
  }
}

/* Walking state - no additional animation needed since we have a walking sprite */
.walking {
  animation: none;

  &.left {
    animation: none;
    transform: scaleX(-1);
  }
}

/* Interacting state */
.interacting {
  animation: none;

  &.left {
    animation: none;
    transform: scaleX(-1);
  }
}
